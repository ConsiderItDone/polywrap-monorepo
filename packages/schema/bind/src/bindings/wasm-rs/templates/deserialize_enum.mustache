{{#required}}
let mut value = {{#toUpper}}{{type}}{{/toUpper}}::_MAX_;
if reader.is_next_string() {
    value = get_{{#toLower}}{{type}}{{/toLower}}_value(&reader.read_string().unwrap_or_default())
        .expect("Failed to get {{#toUpper}}{{type}}{{/toUpper}} value");
} else {
    value = {{#toUpper}}{{type}}{{/toUpper}}::try_from(reader.read_i32().unwrap_or_default())
        .expect("Failed to convert i32 to {{#toUpper}}{{type}}{{/toUpper}}");
    sanitize_{{#toLower}}{{type}}{{/toLower}}_value(value as i32)
        .expect("Failed to sanitize {{#toUpper}}{{type}}{{/toUpper}}");
}
en = value;
en_set = true;
{{/required}}
{{^required}}
let mut value: Option<{{#toUpper}}{{type}}{{/toUpper}}> = None;
if !reader.is_next_nil() {
    if reader.is_next_string() {
        value = Some(get_{{#toLower}}{{type}}{{/toLower}}_value(&reader.read_string().unwrap_or_default())
            .expect("Failed to get Option<{{#toUpper}}{{type}}{{/toUpper}}> value"));
    } else {
        value = Some({{#toUpper}}{{type}}{{/toUpper}}::try_from(reader.read_i32().unwrap_or_default())
            .expect("Failed to convert i32 to Option<{{#toUpper}}{{type}}{{/toUpper}}>"));
        sanitize_{{#toLower}}{{type}}{{/toLower}}_value(value.unwrap() as i32)
            .expect("Failed to sanitize Option<{{#toUpper}}{{type}}{{/toUpper}}>");
    }
} else {
    value = None;
}
opt_enum = value;
{{/required}}